<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ryan.mapper.MemberMapper">
	
	<insert id="memberSignUp">
		INSERT INTO member
		VALUES(
		#{memberEmail},
		#{memberPw},
		#{memberNickName},
		#{memberZipcode},
		#{memberAddress},
		#{memberDaddress},
		#{memberTel},
		#{memberAdmin},
		SYSDATE
		)
	</insert>
	
	<select id="signUpCheck" resultType="Integer">
		SELECT count(*) FROM member
		<choose>
			<when test="memberEmail != null">
				WHERE member_email = #{memberEmail}
			</when>
			<when test="memberNickName != null">
				WHERE member_nick_name = #{memberNickName}
			</when>
		</choose>
	</select>
	
	<update id="memberUpdate">
		UPDATE member
		<set>
			<if test="memberPw != null and memberPw != ''">
				member_pw = #{memberPw}
			</if>
			<if test="memberZipcode != null and memberZipcode != ''">
				member_zipcode = #{memberZipcode}
			</if>
			<if test="memberAddress != null and memberAddress != ''">
				member_address = #{memberAddress}
			</if>
			<if test="memberDaddress != null and memberDaddress != ''">
				member_daddress = #{memberDaddress}
			</if>
			<if test="memberTel != null and memberTel != ''">
				member_tel = #{memberTel}
			</if>
		</set>
		WHERE member_email = #{memberEmail}
	</update>
	
	<!-- 로그인  유효성 체크--> <!-- 주말에 시큐리티 적용예정 -->
	<select id="memberSignIn" resultType="int">
		SELECT count(*) FROM member WHERE member_email = #{memberEmail} and member_pw = #{memberPw}
	</select>
	
	<!-- 로그인 한사람 정보 가져오기 -->
	
	<select id="getLoginMemberInfo" resultType="com.ryan.domain.member.MemberVO">
		SELECT member_email, member_nick_name, member_zipcode, member_address, member_daddress, member_tel, member_signup_date
		FROM member
		WHERE member_email = #{memberEmail} and member_pw = #{memberPw}
	</select>
	
	<!-- 정지 유효성체크? -->
	<select id="memberBanCheck" resultType="int">
		SELECT count(*) FROM member_ban
		<where>
			member_email = #{memberEmail} and ban_check = 1
		</where> 
	</select>
	
	
	<!-- 회원탈퇴 -->
	
	
	
	
	<!-- 여기부터 쿠키 -->
	<!-- 자동로그인 체크시 회원의 닉네임을 가져옴 -->
	<select id="getMemberNickName" resultType="String">
		SELECT member_nick_name FROM member WHERE member_email = #{memberEmail}
	</select>
	
	<!-- 쿠키 로그인 확인 -->
	<select id="autoLogin" resultType="int">
		SELECT count(*) FROM member WHERE member_email = #{memberEmail} and member_nick_name = #{memberNickName}
	</select>
	
	
</mapper>
