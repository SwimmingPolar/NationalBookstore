<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ryan.mapper.SearchMapper">
<select id="typeWriter" resultType="com.ryan.domain.book.EBookVO" parameterType="java.util.Map">
	SELECT DISTINCT book_writer
	FROM (
	SELECT * FROM eBook
	WHERE 
	<foreach collection="array" item="keyword" index="index" separator="OR">
	book_writer like '%' || #{keyword} || '%'
	</foreach>
	) ORDER BY book_writer
</select>
<!-- cd를 foreach에 씌울수도 -->
<select id="typeBookname" resultType="com.ryan.domain.book.EBookVO">
	SELECT DISTINCT book_title
	FROM (
	SELECT * FROM eBook
	WHERE 
	<foreach collection="array" item="keyword" index="index" separator="OR">
	book_title like '%' || #{keyword} || '%'
	</foreach>
	) ORDER BY book_title
</select>
<!--@@@@@@@@@@@@@@@@@@@@@@@@@@@ 이 밑으로 제가 수정 좀 했습니다.   @@@@@@@@@@@@@@@@@@@@@@@@@@@@-->
	<select resultType="com.ryan.domain.book.EBookVO" id="searchEbook" >
		SELECT * FROM EBOOK WHERE
		<choose>
			<when test="param1.equals('BOOK_TITLE')" >
				<foreach collection="param2" index="index" item="search" separator="or">
					BOOK_TITLE LIKE  '%'||#{search}||'%'
				</foreach>
			</when>
			<when test="param1.equals('BOOK_WRITER')" >
				<foreach collection="param2" index="index" item="search" separator="or" >
					BOOK_WRITER LIKE '%'||#{search}||'%'
				</foreach>
			</when>
			<when test="param1.equals('BOOK_PUBLISHER')" >
				<foreach collection="param2" index="index" item="search" separator="or" >
					BOOK_PUBLISHER LIKE '%'||#{search }||'%'
				</foreach>
			</when>
		</choose>
		AND BOOK_EXISTENCE LIKE 0
	</select>
	<!-- 종이책 검색 -->
	<select resultType="com.ryan.domain.book.EBookVO" id="searchPaperbook" >
		SELECT * FROM EBOOK WHERE
		<choose>
			<when test="param1.equals('BOOK_TITLE')" >
				<foreach collection="param2" index="index" item="search" separator="or">
					BOOK_TITLE LIKE  '%'||#{search}||'%'
				</foreach>
			</when>
			<when test="param1.equals('BOOK_WRITER')" >
				<foreach collection="param2" index="index" item="search" separator="or" >
					BOOK_WRITER LIKE '%'||#{search}||'%'
				</foreach>
			</when>
			<when test="param1.equals('BOOK_PUBLISHER')" >
				<foreach collection="param2" index="index" item="search" separator="or" >
					BOOK_PUBLISHER LIKE '%'||#{search }||'%'
				</foreach>
			</when>
		</choose>
		AND BOOK_EXISTENCE LIKE 1
	</select>
</mapper>